# File generated by cdo from CONTRIBUTING.md; DO NOT EDIT.

SHELL=bash
.SHELLFLAGS=-e -o pipefail -c

.PHONY: __help__
__help__:
	@echo 'Usage: make [target]'
	@echo ''
	@echo 'Targets:'
	@echo '  all      Clean build'
	@echo '  build    Build a custom k6 with the extension'
	@echo '  clean    Delete the build directory'
	@echo '  coverage View the test coverage report'
	@echo '  example  Run example'
	@echo '  format   Applies Go formatting to code'
	@echo '  lint     Run the linter'
	@echo '  makefile Generate Makefile'
	@echo '  readme   Update README.md'
	@echo '  test     Run the tests'
	@echo '  tools    Install the required tools'

# Clean build
.PHONY: all
all: clean format test build

# Build a custom k6 with the extension
.PHONY: build
build: 
	@(\
		CGO_ENABLED=1 xk6 build --with github.com/grafana/xk6-sql=. --with github.com/grafana/xk6-sql-driver-ramsql;\
	)

# Delete the build directory
.PHONY: clean
clean: 
	@(\
		rm -rf build;\
		rm -f ./k6;\
	)

# View the test coverage report
.PHONY: coverage
coverage: test
	@(\
		go tool cover -html=coverage.out;\
	)

# Run example
.PHONY: example
example: 
	@(\
		./k6 run examples/example.js  > examples/example.txt 2>&1;\
	)

# Applies Go formatting to code
.PHONY: format
format: 
	@(\
		go fmt ./...;\
	)

# Run the linter
.PHONY: lint
lint: 
	@(\
		golangci-lint run;\
	)

# Generate Makefile
.PHONY: makefile
makefile: 
	@(\
		cdo --makefile Makefile;\
	)

# Update README.md
.PHONY: readme
readme: 
	@(\
		mdcode update;\
	)

# Run the tests
.PHONY: test
test: 
	@(\
		go test -count 1 -race -coverprofile=coverage.out ./...;\
	)

# Install the required tools
.PHONY: tools
tools: 
	@(\
		eget szkiba/mdcode;\
		eget -t 1.57.2 golangci/golangci-lint;\
		go install go.k6.io/xk6/cmd/xk6@latest;\
	)

